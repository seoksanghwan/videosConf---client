(window.webpackJsonp=window.webpackJsonp||[]).push([[0],{187:function(e,t,a){},191:function(e,t,a){"use strict";a.r(t);var n=a(0),o=a.n(n),r=a(18),i=a.n(r),c=a(25),l=a(38),s=a(74),m=a.n(s),u=a(29),d=a(10),p=a(19),b=a.n(p),h="IS_LOGIN_USER",f="FETCH_PRODUCTS_BEGIN",E="GET_ERRORS",g="IS_LOGGED_IN_DATA",v="IS_LOGOUT_DATA",O="ROOMS_DATA",j="RTC_SETTING",y="ADD_MEDIA",k="REMOVE_VIDEO",w="READY_TO_CALL",N={items:{},isLoggedIn:!1,error:null,isroom:[],peers:[],inroom:!0,id:null,webrtc:null,localStream:null,ready:!1,func:"",roomname:""};var I,L=a(9),C=a(75),D=a(28),S=a(12),A=a.n(S),R=a(76),_=a.n(R),V=a(77),T=a.n(V),B=a(21),M=a(22),P=a(26),x=a(23),U=a(27),G=a(193),F=a(195),J=a(196),z=a(194),H=a(192),W=function(e){return o.a.createElement("div",{className:"meeting-room-create"},o.a.createElement("form",null,o.a.createElement("label",{htmlFor:"rooms_title"},o.a.createElement("h1",null,"Vide\u03a9s. ",o.a.createElement(H.a,{className:"navbar-item",to:"/rooms"},"Room List")),o.a.createElement("input",{type:"text",id:"rooms_title",name:"rooms_title",ref:e.inputRef,placeholder:"\uc548\ub155\ud558\uc138\uc694!! \ud68c\uc758\uc2e4\uc744 \uc0dd\uc131\ud574\uc8fc\uc138\uc694."}),o.a.createElement("button",{name:"rooms_title",onClick:e.saveFormData},"Create!"))))},Y=function(e){return o.a.createElement("div",{className:"container"},o.a.createElement("div",{className:"navbar-start"},o.a.createElement("div",{className:"nav-content"},o.a.createElement("div",{className:"nav-menu"},o.a.createElement("dl",null,o.a.createElement("dt",null,o.a.createElement(H.a,{to:"/"},"Vide\u03a9s.")),o.a.createElement("dd",null,o.a.createElement(H.a,{to:"/about"},"About")),o.a.createElement("dd",null,e.isLoggedIn?o.a.createElement(H.a,{to:"/rooms"},"Public Channel"):o.a.createElement(H.a,{onClick:e.signAlert,to:"/"},"Public Channel")),o.a.createElement("dd",null,e.isLoggedIn?o.a.createElement("p",{onClick:e.onLogoutButtonClick},"Sign Out"):o.a.createElement("p",{onClick:e.onLoginButtonClick},"Sign In")))),o.a.createElement("div",{className:"user-info-nav"},e.isLoggedIn?o.a.createElement("p",null,o.a.createElement("img",{src:e.items.url})," ",o.a.createElement("strong",null,e.items.name),"\ub2d8 \uc548\ub155\ud558\uc138\uc694.!!"):o.a.createElement("p",null,"\ub85c\uadf8\uc778\ud574\uc8fc\uc138\uc694.")))))},K=function(e){var t=e.roomDelete,a=e.roomData;return o.a.createElement("div",{className:"rooms-list"},o.a.createElement("dl",null,o.a.createElement("dt",null,o.a.createElement("h2",{className:"title"},"Enjoy Public Room",o.a.createElement("em",null,"\uc5ec\uae30\ub294 \uacf5\uac1c \ud68c\uc758\uc2e4\uc785\ub2c8\ub2e4."))),a.map(function(e){return o.a.createElement("dd",{key:e._id},o.a.createElement(H.a,{to:"rooms/".concat(e.title)},e.title,o.a.createElement("p",null,"Organiser ",e.userName)),o.a.createElement("button",{onClick:t,"data-mail":e.userMail,"data-id":e._id},"Delete"))})))},Q=function(e){function t(e){var a;return Object(B.a)(this,t),(a=Object(P.a)(this,Object(x.a)(t).call(this,e))).addListeners=function(){a.vidset=a.props.vidset,a.webrtc.on("videoAdded",a.addVideo),a.webrtc.on("videoRemoved",a.removeVideo),a.webrtc.on("readyToCall",a.readyToCall)},a.addVideo=function(e,t){a.setState({peers:Object(u.a)(a.state.peers).concat([t])},function(){a.webrtc.attachStream(e,a.remoteVideos[t.id])}),console.log(a.remoteVideos[t.id])},a.removeVideo=function(e){a.setState({peers:a.state.peers.filter(function(e){return!e.closed})})},a.readyToCall=function(){a.webrtc.joinRoom(a.roonName,function(e,t){a.setState({inRoom:!0})})},a.handleSelfMute=function(e){var t=a.state.muted;t?a.webrtc.unmute():a.webrtc.mute(),a.setState({muted:!t})},a.disconnect=function(){a.props.history.push("/rooms"),a.webrtc.stopLocalVideo(),a.webrtc.leaveRoom(),a.webrtc.disconnect()},a.state={peers:[],mutedPeerIds:[],inRoom:!1,muted:!1},a.remoteVideos={},a.roonName=a.props.match.params.room_name,window.onpopstate=function(e){a.webrtc.stopLocalVideo(),a.webrtc.leaveRoom()},a}return Object(U.a)(t,e),Object(M.a)(t,[{key:"componentDidMount",value:function(){this.webrtc=new b.a({url:"https://sandbox.simplewebrtc.com:443/",localVideoEl:this.localVid,nick:"".concat(this.props.email,",").concat(this.props.url),debug:!0,dataOnly:!1,network:{maxPeers:2,minPeers:4}}),this.addListeners(),this.webrtc.startLocalVideo()}},{key:"render",value:function(){var e=this,t=this.state.peers;return o.a.createElement("div",{className:"details-box"},o.a.createElement("div",{className:"sidebar local"},o.a.createElement("h2",null,this.roonName,o.a.createElement("em",null,o.a.createElement("i",{className:"far fa-user"})," ",t.length+1)),o.a.createElement("div",{className:"localBox"},o.a.createElement("video",{id:"localVideo",autoPlay:!0,ref:function(t){return e.localVid=t}}),o.a.createElement("div",{className:"nick"},o.a.createElement("p",null," ",this.props.email," "))),o.a.createElement("div",{className:"buttons"},o.a.createElement("button",{onClick:this.handleSelfMute.bind(this)},o.a.createElement("i",{className:"fas fa-volume-off"})),o.a.createElement("button",{onClick:this.disconnect.bind(this)},o.a.createElement("i",{className:"fas fa-sign-out-alt"}))),o.a.createElement("div",{className:"remotePeerList"},o.a.createElement("h3",null,"Member"),o.a.createElement("ul",null,o.a.createElement("li",null," ",o.a.createElement("img",{src:this.props.url,alt:""})," ",o.a.createElement("p",null,this.props.email)),t.map(function(e){return o.a.createElement("li",{key:e.id}," ",o.a.createElement("img",{src:e.nick.split(",")[1],alt:""})," ",o.a.createElement("p",null,e.nick.split(",")[0]))})))),o.a.createElement("div",{className:"remotevideo"},t.map(function(t){return o.a.createElement("div",{className:"vidContainer",key:t.id,id:"".concat(e.webrtc.getContainerId(t))},o.a.createElement("video",{id:e.webrtc.getId(t),ref:function(a){return e.remoteVideos[t.id]=a},playsInline:!0}),o.a.createElement("div",{className:"nick"},o.a.createElement("p",null,t.nick.split(",")[0])))})))}}]),t}(n.Component),q=function(e){function t(e){return Object(B.a)(this,t),Object(P.a)(this,Object(x.a)(t).call(this,e))}return Object(U.a)(t,e),Object(M.a)(t,[{key:"saveFormData",value:function(e){e.preventDefault();var t=this.props,a=t.isLoggedIn,n=t.items,o=this.inputNode.value;a?o.length>1&&o.length<11?(A.a.post("".concat("http://videos.ap-northeast-2.elasticbeanstalk.com/","rooms"),{title:o,userName:n.name,userMail:n.email}),this.props.history.push("/rooms/".concat(o))):(alert("\ud68c\uc758\ubc29 \uc81c\ubaa9\uc740 2\uae00\uc790 \uc774\uc0c1 10\uae00\uc790 \ubbf8\ub9cc\uc774\uc5d0\uc694.\n\ub2e4\uc2dc \ud55c\ubc88 \uc791\uc131\ud574\uc8fc\uc138\uc694"),this.inputNode.value=""):(this.signAlertMessage(),this.inputNode.value="")}},{key:"render",value:function(){var e=this,t=this.props,a=t.isLoggedIn,n=t.items,r=t.isroom,i=t.webrtc,c=t.peers,l=t.inroom;return o.a.createElement("div",{id:"app",className:"container"},o.a.createElement(Y,{items:n,isLoggedIn:a,signAlert:this.props.signAlert,onLoginButtonClick:this.props.onLoginButtonClick,onLogoutButtonClick:this.props.onLogoutButtonClick}),o.a.createElement(J.a,null,o.a.createElement(F.a,{exact:!0,path:"/",render:function(t){return o.a.createElement(W,Object.assign({},t,{isLoggedIn:a,saveFormData:e.saveFormData.bind(e),inputRef:function(t){return e.inputNode=t}}))}}),o.a.createElement(F.a,{exact:!0,path:"/rooms",render:function(t){return o.a.createElement(K,{roomData:r,roomDelete:e.props.roomDelete})}}),o.a.createElement(F.a,{exact:!0,path:"/rooms/:room_name",render:function(e){var t=e.match.params.room_name,a=(r?r.some(function(e){return e.title===t}):console.log("no"),n.email?n.email:"not");return n.email?o.a.createElement(Q,Object.assign({},e,{email:a,url:n.url,webrtc:i,peers:c,inroom:l})):null}}),o.a.createElement(F.a,{render:function(){return o.a.createElement(z.a,{to:"/"})}})))}}]),t}(o.a.Component),X=function(e){function t(e){return Object(B.a)(this,t),Object(P.a)(this,Object(x.a)(t).call(this,e))}return Object(U.a)(t,e),Object(M.a)(t,[{key:"componentDidMount",value:function(){this.props.usingUserData(),this.props.channelData(),this.props.init()}},{key:"signAlertMessage",value:function(){alert("\ub85c\uadf8\uc778\uc744 \ud574\uc8fc\uc138\uc694")}},{key:"roomDelete",value:function(e){var t=e.target.dataset.id;e.target.dataset.mail===this.props.items.email?A.a.delete("".concat("http://videos.ap-northeast-2.elasticbeanstalk.com/","rooms/dataId"),{data:{id:t}}):alert("\ud68c\uc758\uc2e4 \uc0ad\uc81c \uad8c\ud55c\uc740 \uc8fc\ucd5c\uc790\uc5d0\uac8c\ub9cc \uc788\uc5b4\uc694.")}},{key:"render",value:function(){var e=this,t=this.props,a=t.isLoggedIn,n=t.items,r=t.isroom,i=t.webrtc,c=t.peers,l=t.inroom;return o.a.createElement(G.a,null,o.a.createElement(F.a,{render:function(t){return!1===Boolean(t.location.pathname.split("/rooms")[1])&&null!==i&&i.leaveRoom(),o.a.createElement(q,Object.assign({},t,{isLoggedIn:a,items:n,isroom:r,roomDelete:e.roomDelete.bind(e),onLoginButtonClick:e.props.loginUser,onLogoutButtonClick:e.props.userlogout,signAlert:e.signAlertMessage,webrtc:i,peers:c,inroom:l}))}}))}}]),t}(o.a.Component),Z=new D.auth.GoogleAuthProvider,$=T()(),ee=Object(l.b)(function(e){var t;return t={items:e.items,isLoggedIn:e.isLoggedIn,error:e.error,isroom:e.isroom},Object(L.a)(t,"isroom",e.isroom),Object(L.a)(t,"peers",e.peers),Object(L.a)(t,"id",e.id),Object(L.a)(t,"webrtc",e.webrtc),Object(L.a)(t,"localStream",e.localStream),Object(L.a)(t,"ready",e.ready),Object(L.a)(t,"func",e.func),t},function(e){return{loginUser:function(t){D.auth().signInWithPopup(Z).then(function(t){t.credential.accessToken;var a=t.user,n={uid:a.uid,name:a.displayName,url:a.photoURL,email:a.email};A.a.post("".concat("http://videos.ap-northeast-2.elasticbeanstalk.com/api/auth/","login"),n).then(function(t){var a=t.data.token;!function(e){e?A.a.defaults.headers.common.Authorization=e:delete A.a.defaults.headers.common.Authorization}(a);var n=_()(a);e({type:h,data:n}),localStorage.setItem("user",JSON.stringify(n))})}).catch(function(t){e({type:E,error:t})})},usingUserData:function(){var t=JSON.parse(localStorage.getItem("user"));e({type:g,data:t})},userlogout:Object(C.debounce)(function(){var t=localStorage.removeItem("user");e({type:v,data:t})},1e3),channelData:function(){A.a.get("http://videos.ap-northeast-2.elasticbeanstalk.com/").then(function(t){var a=t.data;e({type:O,data:a})}).catch(function(t){e({type:E,error:t})})},init:function(t){var a=$.location.pathname.split("/rooms/")[1],n=JSON.parse(localStorage.getItem("user")),o=null!==n?"".concat(n.email,",").concat(n.url):"Not user";(I=new b.a({url:"https://sandbox.simplewebrtc.com:443/",localVideoEl:"",network:{minPeers:2,maxPeers:2},debug:!0,nick:o})).on("videoAdded",function(t,a){e({type:y,peer:a,stream:t})}).on("videoRemoved",function(t){e({type:k,peer:t})}).on("readyToCall",function(){e({type:w,rtc:I,roomName:a})}),e({type:j,payload:I})}}},null,{withref:!0})(X);a(187);D.initializeApp({apiKey:"AIzaSyA2aWhmtwcW-HJ80tYyv1Hs2A9MRzY3acQ",authDomain:"videoconference-bf935.firebaseapp.com",databaseURL:"https://videoconference-bf935.firebaseio.com",projectId:"videoconference-bf935",storageBucket:"videoconference-bf935.appspot.com",messagingSenderId:"895553387250"});var te=Object(c.c)(function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:N,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case f:return Object(d.a)({},e,{islogedin:!1,items:{},isroom:[],inroom:!1});case h:return Object(d.a)({},e,{isLoggedIn:!0,items:t.data,inroom:!1});case g:var a=Boolean(t.data)?t.data:{},n=!!Boolean(t.data);return Object(d.a)({},e,{isLoggedIn:n,items:a,inroom:!1});case v:return Object(d.a)({},e,{isLoggedIn:!1,items:{},isroom:[],inroom:!1});case O:var o=Object(u.a)(t.data).concat(Object(u.a)(e.isroom));return Object(d.a)({},e,{isroom:o,inroom:!1});case j:return Object(d.a)({},e,{webrtc:t.payload,inroom:!0});case y:var r=Object(u.a)(e.peers).concat([t.peer]);return Object(d.a)({},e,{peers:r,localStream:t.stream});case k:return Object(d.a)({},e,{peers:e.peers.filter(function(e){return!e.closed})});case w:var i=t.rtc;return Object(d.a)({},e,{inroom:!0,roomname:i.joinRoom(t.roomName)});case E:return t.payload;default:return e}},Object(c.a)(m.a));i.a.render(o.a.createElement(l.a,{store:te},o.a.createElement(ee,null)),document.getElementById("root"))},78:function(e,t,a){e.exports=a(191)}},[[78,2,1]]]);
//# sourceMappingURL=main.81a4a438.chunk.js.map